# hamsterkombat_tokens_bot
Бот, который может отдавать токены для hamsterkombat (требуется генерация в базу данных в бэкграунде)

Установка:
```
git clone https://github.com/seligor/hamsterkombat_tokens_bot.git
cd hamsterkombat_tokens_bot
chmod a+x install.sh
./install.sh
```
Настройка:

В START.sh указать строку подключения к СУБД и ID бота, полученный у https://t.me/BotFather

Запускать можно и с помощью START.sh, но я рекомендую установить screen и запускать start.sh

Пример работы бота:

https://t.me/hamscode_ru_bot

Что делает бот: 
1. Запускается
2. Ждёт запроса токенов
3. После получения запроса подключается к базе данных, ищет в последних 25 записях вникальные префиксы, считает их. Учитываются только те, где не указан id пользователя
4. Далее отдаёт промокоды по 4 штуки на каждый префикс. Записывает в базу дату когда отдал, записывает id того, кому отдал
5. считает сколько промокодов отдал. Если отдал меньше, чем (количество доступных игр) * 4, то может отдать ещё. Количество доступных игр определяется количеством уникальных префиксов промокодов из 3 пункта

Известные недостатки:
1. количество возможных к применению промокодов в хомяке может быть индивидуальным для каждой игры, но бот об этом не знает. Хардкодить это тоже не хочу потому, что такой подход приведёт к необходимости актуализирвать информацию именно в коде. Если у вас есть идея того, как получить список игр с количеством применяемых ключей - пишите.
2. Может возникнуть ситуация, когда промокоды разобрали, в базе нет достаточного количества. При повторном запросе бот не учитывает префиксы, по которым уже был сегодня запрос. И например если останутся только коды MERGE-, то он на каждый запрос будет отправлять только их
3. Из предыдущего пункта вытекает логичная необходимость в быстром наполнении валидными кодами, но для этого нужно использовать разные прокси в генераторе(генератор не в этом репозитории, актуальный генератор сейчас обкатывается у меня локально)
4. Для того чтобы база не разрасталась, желательно дописать функцию, которая удаляет записи, где в поле даты указано не сегодняшнее число. Такие строки не участвуют в выдаче, нужны только для того, чтобы один человек не мог забрать все промокоды.
   
   ![image](https://github.com/user-attachments/assets/1fd204b1-6db9-469f-b392-121756426d00)
